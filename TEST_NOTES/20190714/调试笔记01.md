# 调试笔记01

加入了异常保护，角度大于30°则停转，但没有设置重新启动的条件，因此只能重新插拔。

小车还是直立不起来，理论上应该有个setpoint函数，设置陀螺仪的水平位置，但在final没有找到。该校准函数已经完成。  √

目前限幅是120，电池供电感觉还是比较快，考虑减少。  （改成了100）

velocity中减去movement改为加上movement。  √（在github上找到了相关的算法，发现是加法）

1. 问题找到了，在小车前倾的时候，应让轮子往前转，以抑制前倾的程度。  
在小车后倾的时候，轮子应往后转，以抑制后倾的程度。
2. 调试直立的kp和kd。
    + 首先将速度环置零
    + 再将直立环的kd置零
    + 将kp从小到大调。偏小时，响应速度慢；增大kp，直到小车出现大幅度的低频抖动。

下面是直立的调试参数（kd=0，只改变kp）：
- 10，响应慢
- 30，抖动大
- 25，抖动较大
- 20，看起来不错
- 21，比20反应更快一点了

3. 目前小车直立没问题，但是不能静止。
4. 小车异常保护暂时未加入，问题是加入后陀螺仪控制速度就会变慢许多，后期再考虑优化。


